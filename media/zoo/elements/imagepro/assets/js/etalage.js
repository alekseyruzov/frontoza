(function(b){b.fn.etalage=function(ra){var a=b.extend({align:"left",thumb_image_width:300,thumb_image_height:400,source_image_width:900,source_image_height:1200,zoom_area_width:600,zoom_area_height:"justify",zoom_area_distance:10,zoom_easing:!0,click_to_zoom:!1,zoom_element:"auto",show_descriptions:!0,description_location:"bottom",description_opacity:.7,small_thumbs:3,smallthumb_inactive_opacity:.4,smallthumb_hide_single:!0,smallthumb_select_on_hover:!1,smallthumbs_position:"bottom",show_begin_end_smallthumb:!0,
magnifier_opacity:.5,magnifier_invert:!0,show_icon:!0,icon_offset:20,hide_cursor:!1,show_hint:!1,hint_offset:15,speed:600,autoplay:!0,autoplay_interval:6E3,keyboard:!0,right_to_left:!1,click_callback:function(){return!0},change_callback:function(){return!0}},ra);b.each(this,function(){var g=b(this);if(g.is("ul")&&g.children("li").length&&g.find("img.etalage_source_image").length){var ha=function(){$("start")},$=function(a){J=!0;g.find(".etalage_smallthumb_first").removeClass("etalage_smallthumb_first");
g.find(".etalage_smallthumb_last").removeClass("etalage_smallthumb_last");var q,b;"end"===a?(a=d.eq(D-l).addClass("etalage_smallthumb_first"),b=q=d.eq(D-1).addClass("etalage_smallthumb_last"),q.hasClass("etalage_smallthumb_navtostart")&&(b=q.prev())):(a=d.eq(0).addClass("etalage_smallthumb_first"),q=d.eq(l-1).addClass("etalage_smallthumb_last"),b=a,a.hasClass("etalage_smallthumb_navtoend")&&(b=a.next()));var c="vert"===v?a.position().top:a.position().left;console.log(a.position());Ba(c,a,q,b)},Ca=
function(a){r=r?r-1:0;J=!0;var b=g.find(".etalage_smallthumb_first").removeClass("etalage_smallthumb_first"),d=g.find(".etalage_smallthumb_last").removeClass("etalage_smallthumb_last"),c,f;"left"===a?(c=b.prev().addClass("etalage_smallthumb_first"),f=d.prev().addClass("etalage_smallthumb_last")):(c=b.next().addClass("etalage_smallthumb_first"),f=d.next().addClass("etalage_smallthumb_last"),b=d);r?"left"===a?c.trigger("click"):f.trigger("click"):(a="vert"===v?c.position().top:c.position().left,Ba(a,
c,f,b))},ta=function(){Da();S=parseInt(s.css("borderTopWidth"),10);sa=parseInt(a.zoom_area_distance,10);E=parseInt(s.css("paddingTop"),10);T=a.zoom_area_width-2*S-2*E>a.source_image_width?a.source_image_width:a.zoom_area_width-2*S-2*E;U="justify"===a.zoom_area_height?K+c+F-2*S-2*E:a.zoom_area_height-2*S-2*E;U>a.source_image_height&&(U=a.source_image_height);a.show_descriptions&&(Ea=parseInt(w.css("borderLeftWidth"),10)+parseInt(w.css("borderRightWidth"),10),Fa=parseInt(w.css("marginLeft"),10)+parseInt(w.css("marginRight"),
10),Ga=parseInt(w.css("paddingLeft"),10)+parseInt(w.css("paddingRight"),10),Ha=T-Ea-Fa-Ga);ia=Math.round(a.thumb_image_width/a.source_image_width*T);ja=Math.round(a.thumb_image_height/a.source_image_height*U);ka=G+a.thumb_image_height-ja;la=H+a.thumb_image_width-ia;Ia=Math.round(ia/2);Ja=Math.round(ja/2);a.show_hint&&(Ka=parseInt(a.hint_offset,10)+parseInt(aa.css("marginTop"),10),ma=parseInt(a.hint_offset,10)+parseInt(aa.css("marginRight"),10),"right"===a.smallthumbs_position&&(ma=ma-y-c));"vert"===
v?(ba=V+c+y,g.css({width:ba,height:K})):(ba=V,g.css({width:ba,height:K+c+F}));a.show_icon&&(k={top:K-I.outerHeight(!0)-parseInt(a.icon_offset,10),left:parseInt(a.icon_offset,10)},"left"===a.smallthumbs_position?k.left=y+c+parseInt(a.icon_offset,10):"top"===a.smallthumbs_position&&(k.top+=F+c),I.css(k));a.show_hint&&aa.css({margin:0,top:-Ka,right:-ma});na.css({margin:0,padding:0,width:a.thumb_image_width,height:a.thumb_image_height});La.css({margin:0,padding:0,width:ia,height:ja});k={margin:0,padding:0,
left:(la-H)/2,top:(ka-G)/2};"left"===a.smallthumbs_position?k.left="+="+y+c:"top"===a.smallthumbs_position&&(k.top="+="+F+c);t.css(k).hide();ca.css({width:T,height:U});k={margin:0,opacity:0};"right"===a.align&&"auto"===N?k.left=-(T+2*S+2*E+sa):"auto"===N&&(k.left=ba+sa);s.css(k).hide();a.show_descriptions&&(k={width:Ha,bottom:E,left:E,opacity:a.description_opacity},"top"===a.description_location&&(k.top=E,k.bottom="auto"),w.css(k).hide())},Da=function(){ua=b(".etalage_thumb_active .etalage_source_image",
g);a.source_image_width=parseInt(ua.width(),10);a.source_image_height=parseInt(ua.height(),10)},f,m,L,W,Ma,da,oa,ba,p,k,z=g.attr("id"),O=Math.floor(.7*a.speed),Na=Math.round(a.speed/100),J=!1,r=0,va=!1,M=!0,wa=!1,xa=0,X=0,Y=0,P=0,Q=0,v="hori";"undefined"!==typeof z&&z||(z="[no id]");if("left"===a.smallthumbs_position||"right"===a.smallthumbs_position)v="vert";"object"===typeof b.browser&&b.browser.msie&&9>b.browser.version&&(M=!1,7>b.browser.version&&(va=!0));g.addClass("etalage").show();var h=g.children("li").addClass("etalage_thumb");
h.first().show().addClass("etalage_thumb_active");var ua=b(".etalage_thumb_active .etalage_source_image",g);Da();var n=h.length,ea=a.autoplay;2>n&&(ea=!1);"right"===a.align&&g.addClass("etalage_right");b.each(h,function(a){a+=1;var q=b(this),d=q.find(".etalage_thumb_image").removeAttr("alt").show(),c=q.find(".etalage_source_image"),g=q.find("a");q.data("id",a).addClass("thumb_"+a);!d.length&&c.length?q.prepend('<img class="etalage_thumb_image" src="'+c.attr("src")+'" />'):d.length||c.length||q.remove();
g.length&&q.find(".etalage_thumb_image").data("anchor",g.attr("href"))});f=h.find(".etalage_thumb_image").css({width:a.thumb_image_width,height:a.thumb_image_height}).show();b.each(f,function(){b(this).data("src",this.src)});var t=b('<li class="etalage_magnifier"><div><img /></div></li>').appendTo(g),La=t.children("div").addClass("etalage_loop"),na=La.children("img"),I=b('<li class="etalage_icon">&nbsp;</li>').appendTo(g);a.show_icon&&I.show();var aa;a.show_hint&&(aa=b('<li class="etalage_hint">&nbsp;</li>').appendTo(g).show());
var s,N=a.zoom_element;"auto"!==N&&N&&b(N).length?s=b(N).addClass("etalage_zoom_area").html('<div><img class="etalage_zoom_img" /></div>'):(N="auto",s=b('<li class="etalage_zoom_area"><div><img class="etalage_zoom_img" /></div></li>').appendTo(g));s.hide();var ca=s.children("div").addClass("zoom_div"),Z;M&&(Z=b('<img class="etalage_zoom_preview" />').css({width:a.source_image_width,height:a.source_image_height,opacity:.3}).prependTo(ca).show());var fa=ca.children(".etalage_zoom_img"),w;a.show_descriptions&&
(w=b('<div class="etalage_description'+(a.right_to_left?" rtl":"")+'"></div>').prependTo(s));var u,d,D,l=a.small_thumbs;if(1<n||!a.smallthumb_hide_single)m=b('<li class="etalage_small_thumbs"><ul></ul></li>').appendTo(g),u=m.children("ul"),b.each(f,function(){var a=b(this);L=a.data("src");W=a.parents(".etalage_thumb").data("id");b('<li><img class="etalage_small_thumb" src="'+L+'" /></li>').data("thumb_id",W).appendTo(u)}),d=u.children("li").css({opacity:a.smallthumb_inactive_opacity}),3>l&&(l=3),
n>l?(a.show_begin_end_smallthumb?(L=f.eq(n-1).data("src"),W=h.eq(n-1).data("id"),b('<li class="etalage_smallthumb_first etalage_smallthumb_navtoend"><img class="etalage_small_thumb" src="'+L+'" /></li>').data("src",L).data("thumb_id",W).css({opacity:a.smallthumb_inactive_opacity}).prependTo(u),L=f.eq(0).data("src"),W=h.eq(0).data("id"),b('<li class="etalage_smallthumb_navtostart"><img class="etalage_small_thumb" src="'+L+'" /></li>').data("src",L).data("thumb_id",W).css({opacity:a.smallthumb_inactive_opacity}).appendTo(u),
d=u.children("li"),d.eq(1).addClass("etalage_smallthumb_active").css({opacity:1})):d.eq(0).addClass("etalage_smallthumb_first etalage_smallthumb_active").css({opacity:1}),d.eq(l-1).addClass("etalage_smallthumb_last")):d.eq(0).addClass("etalage_smallthumb_active").css({opacity:1}),b.each(d,function(a){b(this).data("id",a+1)}),p=d.children("img"),D=d.length,"vert"===v&&d.addClass("vertical");Ma=a.magnifier_invert?1:a.magnifier_opacity;var A=parseInt(h.css("borderLeftWidth"),10)+parseInt(h.css("borderRightWidth"),
10)+parseInt(f.css("borderLeftWidth"),10)+parseInt(f.css("borderRightWidth"),10),B=parseInt(h.css("marginLeft"),10)+parseInt(h.css("marginRight"),10),x=parseInt(h.css("paddingLeft"),10)+parseInt(h.css("paddingRight"),10)+parseInt(f.css("marginLeft"),10)+parseInt(f.css("marginRight"),10)+parseInt(f.css("paddingLeft"),10)+parseInt(f.css("paddingRight"),10),V=a.thumb_image_width+A+B+x,K=a.thumb_image_height+A+B+x,c=x=0,ga=0,y=B=A=0,F=0;if(1<n||!a.smallthumb_hide_single)x=parseInt(d.css("borderLeftWidth"),
10)+parseInt(d.css("borderRightWidth"),10)+parseInt(p.css("borderLeftWidth"),10)+parseInt(p.css("borderRightWidth"),10),c=parseInt(d.css("marginTop"),10),ga=parseInt(d.css("paddingLeft"),10)+parseInt(d.css("paddingRight"),10)+parseInt(p.css("marginLeft"),10)+parseInt(p.css("marginRight"),10)+parseInt(p.css("paddingLeft"),10)+parseInt(p.css("paddingRight"),10),"vert"===v?(B=Math.round((K-(l-1)*c)/l)-(x+ga),A=Math.round(a.thumb_image_width*B/a.thumb_image_height)):(A=Math.round((V-(l-1)*c)/l)-(x+ga),
B=Math.round(a.thumb_image_height*A/a.thumb_image_width)),y=A+x+ga,F=B+x+ga;var Ea,Fa,Ga,Ha,Oa,S,sa,E,T,U;va&&(Oa=b('<iframe marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="javascript:\'<html></html>\'"></iframe>').css({position:"absolute",zIndex:1}).prependTo(s));var x=parseInt(t.css("borderTopWidth"),10),G=parseInt(h.css("borderTopWidth"),10)+parseInt(h.css("marginTop"),10)+parseInt(h.css("paddingTop"),10)+parseInt(f.css("borderTopWidth"),10)+parseInt(f.css("marginTop"),10)-
x,H=f.offset().left-g.offset().left-x;"left"===a.smallthumbs_position?H=H+y+c:"top"===a.smallthumbs_position&&(G=G+F+c);var ia,ja,ka,la,Ia,Ja,Ka,ma;if(1<n||!a.smallthumb_hide_single)if("vert"===v?(k={top:0,height:K},"left"===a.smallthumbs_position?(console.log(y+c),h.css({left:y+c})):k.marginLeft=V+c,m.css(k),u.css({height:F*D+D*c+100}),p.css({width:A,height:B}).attr("height",B),d.css({margin:0,marginBottom:c})):(k={width:V},"top"===a.smallthumbs_position?h.css({top:F+c}):k.top=K+c,m.css(k),u.css({width:y*
D+D*c+100}),p.css({width:A,height:B}).attr("width",A),d.css({margin:0,marginRight:c})),p="vert"===v?F*l+(l-1)*c-K:y*l+(l-1)*c-V,0<p)for(f=1;f<=D-1;f+=l-1)for(m=1,m;m<=p;m+=1)"vert"===v?d.eq(f+m-1).css({marginBottom:c-1}):d.eq(f+m-1).css({marginRight:c-1});else if(0>p)for(f=1;f<=D-1;f+=l-1)for(m=1,m;m<=-p;m+=1)"vert"===v?(d.eq(f+m-1).css({marginBottom:c+1}),u.css({height:parseInt(u.css("height"),10)+1})):(d.eq(f+m-1).css({marginRight:c+1}),u.css({width:parseInt(u.css("width"),10)+1}));a.show_icon&&
!a.magnifier_invert&&t.css({background:t.css("background-color")+" "+I.css("background-image")+" center no-repeat"});a.hide_cursor&&t.add(I).css({cursor:"none"});va&&Oa.css({width:ca.css("width"),height:ca.css("height")});var C=h.first().find(".etalage_thumb_image"),R=h.first().find(".etalage_source_image");a.magnifier_invert&&na.attr("src",C.data("src")).show();M&&Z.attr("src",C.data("src"));fa.attr("src",R.attr("src"));a.show_descriptions&&(oa=R.attr("title"))&&w.html(oa).show();var ya=function(){da&&
(clearInterval(da),da=!1)},za=function(){da&&ya();da=setInterval(function(){pa()},a.autoplay_interval)},Pa=function(){t.stop().fadeTo(O,Ma);I.stop().animate({opacity:0},O);s.stop().show().animate({opacity:1},O);a.magnifier_invert&&C.stop().animate({opacity:a.magnifier_opacity},O);ea&&ya()},ra=function(){t.stop().fadeOut(a.speed);I.stop().animate({opacity:1},a.speed);s.stop().animate({opacity:0},a.speed,function(){b(this).hide()});a.magnifier_invert&&C.stop().animate({opacity:1},a.speed,function(){a.click_to_zoom&&
(wa=!1)});clearTimeout(xa);ea&&za()},qa=function(e,c){var d;d=g.find(".etalage_smallthumb_active").removeClass("etalage_smallthumb_active");e.addClass("etalage_smallthumb_active");t.stop().hide();s.stop().hide();c||(J=!0,d.stop(!0,!0).animate({opacity:a.smallthumb_inactive_opacity},O),e.stop(!0,!0).animate({opacity:1},O,function(){J=!1}));g.find(".etalage_thumb_active").removeClass("etalage_thumb_active").stop().animate({opacity:0},a.speed,function(){b(this).hide()});d=h.filter(".thumb_"+e.data("thumb_id")).addClass("etalage_thumb_active").show().stop().css({opacity:0}).animate({opacity:1},
a.speed);C=d.find(".etalage_thumb_image");R=d.find(".etalage_source_image");a.magnifier_invert&&na.attr("src",C.data("src"));M&&Z.attr("src",C.data("src"));fa.attr("src",R.attr("src"));fa.css({width:R.width(),height:R.height()});a.show_descriptions&&((oa=R.attr("title"))?w.html(oa).show():w.hide());ea&&(ya(),za());d=e.data("id");n>=l&&d--;Ta(d)},Ba=function(e,c,g,f){b.each(d,function(){var d=b(this),c={opacity:a.smallthumb_inactive_opacity};d.data("id")===f.data("id")&&(c.opacity=1);"vert"===v?c.top=
"-="+e:c.left="-="+e;d.animate(c,O,"swing",function(){J&&(f.addClass("etalage_smallthumb_active"),J=!1)})});qa(f,!0)},Qa=function(){var a=P-X,b=Q-Y,d=-b/Na;X-=-a/Na;Y-=d;1>a&&-1<a&&(X=P);1>b&&-1<b&&(Y=Q);fa.css({left:X,top:Y});M&&Z.css({left:X,top:Y});if(1<a||1<b||1>a||1>b)xa=setTimeout(function(){Qa()},25)},Aa=function(){var e;a.magnifier_invert&&g.find(".etalage_thumb_active").mouseleave();if(a.right_to_left){if(e=g.find(".etalage_smallthumb_active").next(),!e.length)return n>l?ha():d.first().trigger("click"),
!0}else if(e=g.find(".etalage_smallthumb_active").prev(),!e.length)return n>l?$("end"):d.last().trigger("click"),!0;e.trigger("click")},pa=function(){var e;a.magnifier_invert&&g.find(".etalage_thumb_active").mouseleave();if(a.right_to_left){if(e=g.find(".etalage_smallthumb_active").prev(),!e.length)return n>l?$("end"):d.last().trigger("click"),!0}else if(e=g.find(".etalage_smallthumb_active").next(),!e.length)return n>l?ha():d.first().trigger("click"),!0;e.trigger("click")};window[z+"_previous"]=
function(){Aa()};window[z+"_next"]=function(){pa()};window[z+"_show"]=function(e){(n<=l||!a.show_begin_end_smallthumb)&&--e;var b=d.eq(e);if(b.length&&!J){var c=g.find(".etalage_smallthumb_active").data("id")-1;if(c>e){r=c-e;var f=g.find(".etalage_smallthumb_first"),h=f.data("id");e<h?(r-=c-h,f.trigger("click")):qa(b,!1)}else c<e&&(r=e-c,f=g.find(".etalage_smallthumb_last"),h=f.data("id")-1,e>=h?(r-=h-c-1,f.trigger("click")):qa(b,!1))}};var Ta=function(e){a.change_callback(e,z)&&"function"===typeof etalage_change_callback&&
etalage_change_callback(e,z)};h.add(t).add(I).mouseenter(function(){a.show_hint&&aa.hide();a.click_to_zoom&&!wa||Pa()}).mouseleave(function(){ra()});var Ra=-(a.source_image_width-T),Sa=-(a.source_image_height-U);h.add(t).add(I).mousemove(function(e){var b=Math.round(e.pageX-C.offset().left+H);e=Math.round(e.pageY-C.offset().top+G);b-=Ia;e-=Ja;b<H&&(b=H);b>la&&(b=la);e<G&&(e=G);e>ka&&(e=ka);t.css({left:b,top:e});a.magnifier_invert&&na.css({left:-(b-H),top:-(e-G)});P=-(1/(a.thumb_image_width/a.source_image_width)*
(b-H));Q=-(1/(a.thumb_image_height/a.source_image_height)*(e-G));P<Ra&&(P=Ra);Q<Sa&&(Q=Sa);a.zoom_easing?(clearTimeout(xa),Qa()):(M&&Z.css({left:P,top:Q}),fa.css({left:P,top:Q}))});if(1<n||!a.smallthumb_hide_single)d.click(function(){var a=b(this);if(!a.hasClass("etalage_smallthumb_active")&&(!J||r)){if(a.hasClass("etalage_smallthumb_first")&&a.prev().length)Ca("left");else if(a.hasClass("etalage_smallthumb_navtoend"))$("end");else if(a.hasClass("etalage_smallthumb_last")&&a.next().length)Ca("right");
else if(a.hasClass("etalage_smallthumb_navtostart"))ha();else{if(r&&!b(this).next().length)return $("end"),!0;if(r&&!b(this).prev().length)return ha(),!0;qa(a,!1)}ta()}}),a.smallthumb_select_on_hover&&d.mouseenter(function(){b(this).trigger("click")});a.click_to_zoom?h.click(function(){wa=!0;Pa()}):t.click(function(){var b=C.data("anchor");if(b){var c;a.click_callback(b,z)?"function"===typeof etalage_click_callback?(etalage_click_callback(b,z),c=!1):c=!0:c=!1;c&&(window.location=b)}});1<n&&a.keyboard&&
b(document).keydown(function(b){if(39===b.keyCode||"39"===b.keyCode)a.right_to_left?Aa():pa();if(37===b.keyCode||"37"===b.keyCode)a.right_to_left?pa():Aa()});b(window).bind("load",function(){h.css({"background-image":"none"});s.css({"background-image":"none"});M&&(M=!1,Z.remove());ta()});ta();ea&&za()}});return this}})(jQuery);